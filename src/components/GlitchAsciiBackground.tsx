import {
  useState,
  useEffect,
  useRef,
  useCallback,
} from "react";

interface MousePosition {
  x: number;
  y: number;
}

export function GlitchAsciiBackground() {
  const [mousePos, setMousePos] = useState<MousePosition>({
    x: 0,
    y: 0,
  });
  const [isHovering, setIsHovering] = useState(false);
  const [isOverDisableZone, setIsOverDisableZone] = useState(false);
  const [glitchedPattern, setGlitchedPattern] = useState("");
  const rafRef = useRef<number>();

  const basePattern = `+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*******************************+++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*++++++++++++++++++++++++++++++++++++++*++++++++++++++++++*+++++++++++++++******************************++++
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*@**#%=*###==+=++++++++++++++++++++++++++***********+++++++++++*******+++++++++++++++++++++********************++++
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*#@@%==#+=*#*%:+++=+++++++++++++++++++++++**************++++++++++++*****++++++++++++++++++++++++****************++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*@@@@@%=+##+*##-=#=+=++++++++++++++++++++++++***************++++++++++++++++++++++++++++++++++++++****************++++
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#@@@@@@@*##+#+##@#**#*#*#+++++++++++++++++++++****************+++++++++++++++++++++++++++++++++++++*****************+++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*@@@@@@@@@*=*%#*#%*#*%*%+=#++++++++++++++++++++++++++*********+++++++++++++++++++++++++++++++++++++******++*+*******#*++
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*@@@@@@@@@@@*-##@@%#%#=*%%#*#*+++++++++++++++++++++++++*+**++++++++++++++++++++++++++++++++++++++**++++++*+++++*****+++*+
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*@@@@@@@@@@@+*==+%%%+##+#+=*:*#*%++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*********+++++++++++++++
+++++++==-=+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*@@@@@@@@@@@-+%=%+%%%*###@:++==*##+=+++++++++++++++++++++++++++++++++++++++++++++++++++++++++******++++++++++++++++++++++
++++++++====++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++@@@@@@@@%@@@@--*=*+%%@%@*#%**-=+%#*%%++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++@@@@@@@@@@@@:+===*=-%@@%@%%%#=-+##=**%+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++@@@@%%%@@%%@#---=-:=#%%%%%%@%%=-*%%%+*#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
++=+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*%#@@@@@@@@@@@%%@#+==-=%+#%%%%%@@*#%*%#=+-#*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
++===--==++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*@@@@%%@@@%@%@%%%%%:=*:=++#%%%@%%@%#%*%##*+-++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+++=-----:-=+++++=======++++++++++++++++++++++++++++++++++++++++++++++++++++%@@@@@@%%%%%@%%%%%%@@:**+#:%%%%%%#%@%%@*#%%+=##++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+++=--:::::-=++===========+++++++++++++++++++++++++++++++++++++++++++++#@@@@@@@@@@@%@@%%@@@@@@@@@%*#%#*#%%%%%*%@@#%*#%@-+%*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++=========
++++=-------==+========++=====+++++++++++++++++++++++++++++++++++++++++#@@@@@%%%@@@@@@@@@@@@%@*%%@%%##%@=#%@@@%@%%#*#+##*@++++++++++++++++++++++++++++++++++++++++++++++++++++++===+++++++++===============
+++++++===-==++===-===============+++++++++++++++++++++++++++++++++++++%@@@%%@@@%%@%@@@@@@%%@@#%@@%%-*##=%@%@@@%@@%%*###*#%#+======+++++++++++++++++++++++++++++++++++++++====++===========================
+++++++++=+++++++====------====++=+++++++++++++++++++++++++++++++++++++@@@@@@@@@@@@@@@@@@@%#@%@#@%@%@###%%%@@@@@@@@*%%%@*+#*#=======++++++++++++++++++++==++++++++++++++++++===============================
++++++++++++++++++=====------====++++++++++++++++++++++++++++++++++++++@@@@@@@@@%@%%@%@@@#**%%@@@@@@@@@#%%%%%@@@@@@@@@%%#+###*======+++++++++++++++++==========+++++++++++=================================
++++++++++++++++++++++++=========++==+++++++++++++++++++++++++++++++++#@@@@@@%@@@@@@%@%@%@.%*%##@@=@%%%+*%%%%%%%@@@@@%@#==*@%%#=====+++++++++++++++++==============+++++===================================
++++++++++++++++++++++++++==+=======++++++++++++++++++++++++++++++++==%@@@@@@@@@@@@@@@@@###-%=#==#@@%%%#%%%%%%%%@@@@@@@@@=#%%%%%#====++++++++++++++========================================================
++++++++++++++++++++++++++==+=+==+++++++++++++++++++++++++++++++====-+@@@@@@@@@@@@@@%@#.*%+-:*+*@#=@@@%#+%*%+%#%@@@@@@@@@@%%%%%@%#==+++++++++++++==++======================================================
++++++++++++++++++++++++======+++++++++++++++++++++++++++++++==---=*#@@@@@@@%%@@@%%%@#* :#%+= -:-%=%%-*#@%%%%++%:%@@@@@@@@%%%%%%%%#*++++++++++=============================================================
++++++++++++++++++++++++++==++++++++++++++++++++++++++++++==---::%@@@@@@%@@%@@%%%%%@@:**+-+%%%--+.=%%@.%%%%%%@#=# @@@#%@@#=#%%%%%%%%%@%+++=================================================================
++++++++++++++++++++++++++++++++++++++++++++++++++++++==--:::::.#@@@@@@%@%@@@@%%%@@@##-=-.=#%#%-:---=@-%%%@=@@+:-=*@@@%#*++%%%%%%%@%%%%+++=================================================================
+++++++++++++++++++++++++++++++++++++++++++++======+==--:::::..:@@@%@@@@%@@@@@%%%@@#%*-+:=-+#+%#+:+.-+*%@%+@@@#-:=+@@@@@***#%%%@@@@@%@@@%+=================================================================
+++++++++++++++++++++++++++++++++++++++++==+===---=--:::::::::.=@@@@@@@@@@@%@%%%@@%+=%@+*#.=#+%%-#=+:=:#%@@*=#@*:#@@@@@%=-+%%%%%%%@%%%%@@@=================================================================
++++++++++++++++++++++++++++++++++++++++==+++===---:::.:::::::-@@%%@@%@@@@@@%%@@@@%#+*@%.:::+*##%%*=%**.+%#@#:#@=::*%@@%=+*@%%%%%%%%%@@@@@%================++==============================================
+++++++++++++++++++++++++++++++++++++++========--::::.:::::::+@@%%%%%@@@%%@@@%@@@+%+-+#**+#%+=%-+#@#+%%+-#%=%@:%*+::-*%*++%=#%%%%%%%%%@@@@@%#+===============++++==========================================
++++++++++++++++++++++++++++++++++++++========---:::::::::::%@%%%@%%%%%@%@@@@@@%%%.**: :+@:#%#-*##%@@%%**+#+@@%@@%+.#-*+++#@*#%%%%%%%%%@@@@@@@@@@*@@@=========+++++========================================
++++++++++++++++++++++++++++++++++++========------::::::::#@@%%%%%@@@%@@%@@@@@@ ..+*%#.:-.:-#%%###%@@%#%@#**@@%%@@@@+++**@#%@@@%%%%%%%%%@@@@@@@@@@@@@%@%====+*****+========================================
+++++++++++++++++++++++++++++++++=========----------:::-%@@@@%%@%%%%%@@@@@@@@@@    :+#=%++:-%#@@%#@@@@@##%*##%@@#%@%@%=:%@@@@@@%%%%%%%%@@@%@@@@@@@@@@%%@%@#++****++========================================
++++++++++++++++===++++++++==========+====----------:*@@@%@@%%%%%%%@%@@@@@@@@%  :.   =.---:=#@%%@@#@%@@@%%%#%%@@@@@@@@%+*%@@@@@%%%%%%%%%@@@@@@@@@@@@@@%%%%@%#******========================================
+++++++++++++=========++++++==============-------:%@@@@@@@%%%%%%@%@@@@@@@@@@@+   .   .::::.:##%#%%@%%%@@@@@@%%@%@%@@@@@%%@@@@@%%%%@@%%%%%%@@@@@@@@@@@@@%%%%%%%#**++++=+++==================================
++++++++==++==++++====+++++=====++============--=@@@@@@%%%%%%%@@@@@@@@@@@@@@@@%.      ..-:: .=+###%@#@%#@%@@@%%%@@@@@@@@%@@@@@%%%%%%%%%%%%%@@@@@@@@@@@@@%%%%%%%%###++++++++================================
=============++=++==-=++=======================@@@@@@@@%%%@%%@@%%@@@@@@@@@@@@@@@:.      ..:=-.-*#*#%%*%@%@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%@%%@@@@@@@@@@@@%%%%%%%%%%%%%#*+***+=+===============-::::-=======
==================---=======================+@@@@@@@%%%%%%@%%@@@@@@@@@@@@@@@@@@@@#:    . ...:+#-*#*#%%#%%%#@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@%%%%%%%%%@%%%%#*+================-::.::::::--===
=================------===================#@@@@@@@%%%%@%%%%%%@@@%%%%@@@@@@@@@@@@@@+%:   . ..::.::+*+#@*#%%@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%@%%@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%#####*++++++=++===--=-:.:::::---==
================------=================+@@@@@@@@@@@@@%%@@%%%%%%%@@@@@@@@@@@@@@@@@@:--#-  . .:::.. -#:-+-*@@@@@@@@@@@@@@@@@@@@@@%@%%%%@@%@@%%@@@@@@@@@@@@@@@@@%%%%%%%%@%@%%%########**++=------=:.-::-----==
=====================================@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%.....  :   ..   ## .-.=@@@@@%@@@@@%@@@@@@@@@@@%%%@@@@@@@%@@@@@@@@@@@@@@@@@@%%%%%%%%@%%%%%%%%#####*++==---:-----:-----==+
====================================@@@@@@@@@@@@@@@@@%@%@@@@@@@@@@@@@@@@@@@@@@@%@@%@.   .     .     :. -=:+@@@@%@@@@@@%%%%@@@@@@%%%@@@@@%@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%@%%%%#%###**++===-=-:::--====**+++
+#####%%#%###*====+**#+============@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@#=%@%*   .      ..   . :#+#@@%%@%@@%%%@%%@@@@@%@@%@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%@%@@%%@@#%#**+==+++#**=--::::--::-
%%@@@@@%%%%%%%%#*+****##***++++=+@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@%@#%%%@@@@@=%%%*+%-  -      .-   ..*%@@%@@@@@%%%@%%%%%%%%%%%@%@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%@%%@@%%%%@%#++++**#****#@%*--:...
@@@@@%%%%%%%%#%%%%####%%%%%##%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#@###+#@*.@@@:-*@%:-       =...=+#@@@@%@@@%@%@@%%%%%%@@@@@@@@@@@%%%@%@@@@@@@@@@@@@@@@@@@@@@@@@@#%%%%%%%%###%@#%##******#@@#%##%+...
@@@@%%%%%%%%%####%%%%%%@%%%%%%%%@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@+* =-+.%@%@+*@#-+       . :.*##@%%%@@%%%@@@@@%%@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%#%%##%%%%%@%###*+*****######*#: 
@@@@%%%%%%%%######%%%%@%%%%#%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@*#%##@@@@@@@@@@@@=.::-  -=#@@@@:+         .:+***%%@%%@@@@@@@@@@@@@@@@@@@@@@%%%@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@%%@%%%%%@@@@@##%+*+++*####%##%#*
@@@@@%%%%%%%###**###%%%@%%####%%#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#@@@@@@@@@@@@%.  -*  .=%%@@@ =#-     . .:=*#+%%%@@@@@@@@@@@@@@@@@@@%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@%%%%@@%@%#*******#####%#%#%%
@@@%%%%%%%%%%###***##%%%%%########%@@@@@@@@@@@@@@%%@@@@@@@@@@@@#%@@@@@@@@@@@@@@@@.. *  .#*@@++%=@*       .:==*+#%@@@@@@@@@@%@@@@@@@@@%%%%@%%@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@%%%@@@@@%*+###+###%##%@@@@
@@@@@%%%%%%%%###***###%%%########%%@@@@@@@@@@%%@@%%#%%@@@@@#@@@@@-@@@@@@@@@@@@@@@@#-.#  =%-@:%-+@@@        :****#%@@%@@@@@@@@%%%@@@%%%%@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%@@+**#%%##%%@##%@@@
@@@@@@%%%%%%%####***####%%#####%%%%%@@@@@@@%%##%%%%%@@@@@@@@@#@+@=@@@@@@@@@@@@@@@@@%=%%:.%#.*-@*%@@@=  .  :=++*++=%%%%%%@@%%%%%%%%@%%%%%%%%%%%%@@@%%%@%@@@%%%@@@%%%%@@%%%@@@@%%%%%%%%@%@@@@***#######%###@@
%@@@@@@%%%%%%###################%%%@@@%%%%##***##%%%@@@@@-.%@+%@=*@@@@@@@@@@@@#@@@@@@%*%-=@+-:*++#@@*=%..:-+***+==+#%%%%%%%%%%%@@%%%%%%%%%%%%%%%@@%%%%%%@@%%%%%%%%%%%%%%%%%@@@%%%%%%%%%@@@%#++*##*+#######%
%%@@@@@%%%%%%%%%%################%%%%%%%%########%@@@@@@@@*#%@*@+.-@@@@@@@@@@@%=@@@@@#@@=- #--:+:+#@@*:%=-*==+++%=-:*%%%%%%%%%%%%%%%%%@%%%%%%%%%%%%%%%%@@%%%%%%%%%%%%%%%%%%%%@@@@@@%%%%%@@@%#+##*%*#####@@@
%%@@@@@@%%%%%%%%%%%%%%%%###%%%%%%%%%########*####%@@@@@@@@%@@@@%=.-%@@@@@@@@@@@@-@@@@@@@@@*:*-.-*#.=@@@  ::%++==+====+#%%%%%%%%%%%%%%@%%%%%%%%%%%%%%%%%%@@%%%%%%%%%%%%%%%%%%%@@@@@@@@%%%%@@####%%####%@@@@@
%@@@@@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%%@@#@@@@@@@#=#@@@@-.:@@@@@@@@@@@@@-%@@@@@@@@@=#==@@@%+=@@+...:-+==+=+++**#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@%%%@@@@#####@@@@@@@@
%@@@@@@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@.-@@@@@@*@%@@@+.  %@@@@@@@@@@@@*@@=#@@@@@@+=@@@@@*@@@@#.:-:.::-+:*=*%#*+*##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%%%%%@@@@@@@@@@@
@@@@@@@@@@@@@%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@##**%@#%@+#@@@@@=..:#%@@@@@@@@@@#%@@##@@@@@*+##%*@@@@@@@:+=:   .::.*+#*+*########%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##%%@@@@@@@@@@@@@
@@@@@@@@@@@@%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@=%@@*#@=*=%@@@@@@+:=####@%@@@@@@%*#%#*##@%##%##+#**##++%*%*- --..:.-**#################%%%%%%%#%###%%%##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%@@@@@@@@@@@@@@
@@@@@@@@@@@@@%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+#@@@@@@#=+##*#%*#%%@@%%+###+*%@@%###***=-=*+#=-##*-.:.:::-=#%%%%%%%%%###************##*******######%%%%%%%%############%%%%%@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*=+#**##%@@%%%#%++*++%%%%#*++---::::+*+=++==::.::--#%%%%%%%%%%%%##################***######################%%%%%%%@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#@@@@@@@+-*%@@@@@@@@%%######%###*====--:---=+==+======---===#%%%%%%%%%%#########%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@%######@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%*#:.::=#%++#%@@@@@@@*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%*****+++**+************++*******#%%%%%%%%%%###%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-......:::-=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%###########################%%%%%%%%%%%%@@%##%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@##+-::::--==*%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%@@@%@@@@@@@@@@@@@@%%%%@%%%@@%#%%#%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#@%####+====+%%%@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%@@@@@@@@@@@@@@@@@%%%%%%%%######%%%%@@@@@@@@@@@%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%###%@%%#######@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%####%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%@@@@%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`;

  const glitchCharsArray = [
    "▲",
    "▼",
    "◦",
    "●",
    "◆",
    "◊",
    "■",
    "□",
    "▪",
    "▫",
    "◢",
    "◣",
    "◤",
    "◥",
    "░",
    "▒",
    "▓",
    "█",
    "╬",
    "╪",
    "┼",
    "┿",
    "╄",
    "╃",
    "╅",
    "╆",
    ":",
    "-",
    "=",
    "+",
    "*",
    "#",
    "%",
  ];

  // Initialize glitched pattern
  useEffect(() => {
    setGlitchedPattern(basePattern);
  }, []);

  // Optimized mouse move handler for cursor-following glitch
  const handleMouseMove = useCallback((e: MouseEvent) => {
    const heroSection = document.querySelector(".hero-section");
    if (!heroSection) return;

    if (rafRef.current) {
      cancelAnimationFrame(rafRef.current);
    }

    rafRef.current = requestAnimationFrame(() => {
      const rect = heroSection.getBoundingClientRect();
      const newX = e.clientX - rect.left;
      const newY = e.clientY - rect.top;

      // Check if cursor is over a glitch-disable zone
      const elementUnderCursor = document.elementFromPoint(e.clientX, e.clientY);
      const isOverDisableElement = elementUnderCursor?.closest('.glitch-disable-zone') !== null;
      
      setIsOverDisableZone(isOverDisableElement);
      
      // Only update position if not over disable zone and position changed significantly
      if (!isOverDisableElement) {
        setMousePos(prev => {
          if (Math.abs(prev.x - newX) > 3 || Math.abs(prev.y - newY) > 3) {
            return { x: newX, y: newY };
          }
          return prev;
        });
      }
    });
  }, []);

  // Handle mouse movement detection
  useEffect(() => {
    const heroSection = document.querySelector(".hero-section");
    if (!heroSection) return;

    const handleMouseEnter = () => setIsHovering(true);
    const handleMouseLeave = () => {
      setIsHovering(false);
      if (rafRef.current) {
        cancelAnimationFrame(rafRef.current);
      }
    };

    heroSection.addEventListener("mousemove", handleMouseMove);
    heroSection.addEventListener("mouseenter", handleMouseEnter);
    heroSection.addEventListener("mouseleave", handleMouseLeave);

    return () => {
      heroSection.removeEventListener("mousemove", handleMouseMove);
      heroSection.removeEventListener("mouseenter", handleMouseEnter);
      heroSection.removeEventListener("mouseleave", handleMouseLeave);
      if (rafRef.current) {
        cancelAnimationFrame(rafRef.current);
      }
    };
  }, [handleMouseMove]);

  // Cursor-following glitch animation
  useEffect(() => {
    if (!isHovering || isOverDisableZone) {
      setGlitchedPattern(basePattern);
      return;
    }

    let animationId: number;
    let lastUpdateTime = 0;
    const throttleMs = 50; // Smooth cursor following

    const updateGlitch = (currentTime: number) => {
      // Throttle updates for performance
      if (currentTime - lastUpdateTime < throttleMs) {
        animationId = requestAnimationFrame(updateGlitch);
        return;
      }
      
      lastUpdateTime = currentTime;

      const lines = basePattern.split("\n");

      // Character grid calculations for text-xs (12px) with leading-none
      const charWidth = 7.2; // Character width for Courier New 12px
      const lineHeight = 12; // Line height for text-xs with leading-none

      // Convert mouse position to character grid coordinates
      const centerY = Math.round(mousePos.y / lineHeight);
      const centerX = Math.round(mousePos.x / charWidth);

      // Perfect circle radius accounting for character aspect ratio
      const radiusChars = 8; // Desired circle radius (bigger)
      const aspectRatio = charWidth / lineHeight; // ~0.6
      const radiusY = Math.round(radiusChars * aspectRatio); // Adjust vertical radius for aspect ratio

      const newLines = lines.map((line, lineIndex) => {
        const lineDistance = Math.abs(lineIndex - centerY);
        if (lineDistance > radiusY) return line; // Keep original line if too far

        return line
          .split("")
          .map((char, charIndex) => {
            // Perfect circle calculation with aspect ratio correction
            const dx = (charIndex - centerX) / radiusChars; // Normalize X
            const dy = (lineIndex - centerY) / radiusY; // Normalize Y with aspect ratio
            const distance = Math.sqrt(dx * dx + dy * dy);

            // Only glitch characters within the perfect circle around cursor
            if (distance <= 1 && Math.random() > 0.4) {
              return glitchCharsArray[
                Math.floor(Math.random() * glitchCharsArray.length)
              ];
            }
            return char;
          })
          .join("");
      });

      setGlitchedPattern(newLines.join("\n"));

      // Continue animation
      animationId = requestAnimationFrame(updateGlitch);
    };

    // Start animation immediately when hovering
    animationId = requestAnimationFrame(updateGlitch);

    return () => {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
    };
  }, [isHovering, isOverDisableZone, mousePos.x, mousePos.y]);

  return (
    <div className="absolute inset-0 overflow-hidden pointer-events-none">
      {/* Base ASCII Pattern with simplified glitch */}
      <div className="text-accent/40 text-xs font-mono leading-none whitespace-pre absolute top-0 left-0 w-full">
        {glitchedPattern}
      </div>
    </div>
  );
}